<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <title>Janal Kaaj - Dashboard</title>
  <link rel="stylesheet" href="../CSS/styleDashboard.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../CSS/style.css">

  <link rel="stylesheet" href="../node_modules/@sweetalert2/themes/bootstrap-4/bootstrap-4.min.css">
  <script src="../node_modules/sweetalert2/dist/sweetalert2.all.js"></script>

  <!-- Boxiocns CDN Link -->
  <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
  <!-- Dashboard -->
  <div class="sidebar close">
    <div class="logo-details">
      <i class="bx seleccionador"></i>
      <span class="logo_name">Janal Kaaj</span>
    </div>


    <ul class="nav-links">
      <li>
        <a href="/pestanas_Encuestador/dashboard.html">
          <i class="bx bx-grid-alt"></i>
          <span class="link_name">Dashboard</span>
        </a>

        <ul class="sub-menu blank">
          <li><a href="" id="mostrarSeccion1">Dashboard</a></li>
        </ul>
      </li>


      <li>
        <a href="/login.html">
          <i class='bx bx-home-alt'></i>
          <span class="link_name">Login</span>
        </a>

        <ul class="sub-menu blank">
          <li><a class="link_name" href="/login.html">Login</a></li>
        </ul>
      </li>



      <li>
        <div class="iocn-link">
          <a href="#" onclick="showAlert('variables')"> <!-- Llamamos a showAlert con el argumento 'variables' -->
            <i class='bx bx-file-blank'></i>
            <span class="link_name">Crear variables</span>
          </a>
          <ul class="sub-menu blank">
            <a class="link_name" href="#" onclick="showAlert('variables')">Crear variables</a>
          </ul>
        </div>
      </li>

      <li>
        <div class="iocn-link">
          <a href="#" onclick="showAlert('reactivos')"> <!-- Llamamos a showAlert con el argumento 'reactivos' -->
            <i class='bx bx-file-blank'></i>
            <span class="link_name">Crear reactivos</span>
          </a>
        </div>
        <ul class="sub-menu blank">
          <a class="link_name" href="#" onclick="showAlert('reactivos')">Crear reactivos</a>
        </ul>
      </li>

      <li>
        <a id="pruebaApli" href="#" onclick="redireccionarConUserId()">
          <i class='bx bx-book-add'></i>
          <span class="link_name">Alta Aplicadores</span>
        </a>

        <ul class="sub-menu blank">
          <li><a class="link_name" href="/pestanas_Encuestado//Aplicador.php">Alta Aplicadores</a></li>
        </ul>
      </li>

      <li>
        <a href="/pestanas_Encuestado/asignarE.php">
          <i class='bx bxs-user-check'></i>
          <span class="link_name">Asignar</span>
        </a>

        <ul class="sub-menu blank">
          <li><a class="link_name" href="/pestanas_Encuestado/asignarE.php">Asignar</a></li>
        </ul>
      </li>

      <li>
        <a href="../BD/prueva/consultaDatos.php">
          <i class='bx bx-clipboard bx-tada'></i>
          <span class="link_name">Encuestas aplicadas</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="../BD/prueva/consultaDatos.php">Encuestas aplicadas</a></li>
        </ul>
      </li>

      <li>
        <a href="#">
          <i class="bx bx-pie-chart-alt-2"></i>
          <span class="link_name">Análisis</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Análisis</a></li>
        </ul>
      </li>


      <li>
        <a href="#">
          <i class="bx bx-line-chart"></i>
          <span class="link_name">Graficas</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Graficas</a></li>
        </ul>
      </li>

      <!-- <li>
        <a href="#">
          <i class="bx bx-cog"></i>
          <span class="link_name">Configuración</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Configuración</a></li>
        </ul>
      </li> -->


      <li>
        <a href="perfil_Encuestador.html">
          <i class='bx bx-user'></i>
          <span class="link_name">Perfil</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="perfil_Encuestador.html">Perfil</a></li>
        </ul>
      </li>

      <!-- Cerrar cesion -->
      <li id="cerrarSesionBtnContainer">
        <a href="#" id="cerrarSesionBtn" onclick="confirmarCerrarSesion()">
          <i class="bx bx-log-out"></i>
          <span class="link_name">Cerrar Sesión</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#" onclick="confirmarCerrarSesion()">Cerrar Sesión</a></li>

        </ul>
      </li>
    </ul>
  </div>

  <section class="home-section">
    <div class="home-content">
      <i class="bx bx-menu"></i>
      <span class="text">Dashboard</span>
    </div>
    <!-- Fin Dashboard -->
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-sm-10 col-md-8 col-lg-6 p-4 shadow-lg bg-light rounded">
          <div class="row">
            <div class="col-12">
              <h3 class="text-center mb-4">Bienvenido</h3>
            </div>
            <div class="col-12 text-center mb-2">
              <label class="col-form-label">Usted es un <span class="fw-bold">Encuestador.</span></label>
            </div>
            <div class="col-12" id="grupo__nombrecompletos">
              <label for="nombrecompletos" class="col-form-label mb-2">Usted inició sesión con el correo:</label>
              <div class="input-group">
                <input id="aqui" name="aqui" type="text" class="form-control text-center" disabled>
              </div>
            </div>
          </div>

         <script>
document.addEventListener('DOMContentLoaded', function () {
    var userId = localStorage.getItem('user_id');
    var userCorreo = localStorage.getItem('user_correo');
    var userCorreo2 = localStorage.getItem('correo');
    
    if (userId) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/BD/infoUser.php?id=' + userId  , true);
        xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
        if (xhr.status === 200) {
            try {
                var userInfo = JSON.parse(xhr.responseText);
                if (userInfo && userInfo.error) {
                    console.error('Error obteniendo información del usuario:', userInfo.error);
                } else {
                  document.getElementById('aqui').value = userCorreo;
                  document.getElementById('userCorreo').textContent = userCorreo;
                 // document.getElementById('Institucion').value = userCorreo;
                }
            } catch (error) {
                console.error('Error al analizar la respuesta JSON:', error);
            }
        } else {
            console.error('Error en la solicitud AJAX para obtener información del usuario.');
        }
    }
};
        xhr.send();
    }
    verificar() 
});
//para enviar el id a agregar aplicador 
function redireccionarConUserId() {
    var userId = localStorage.getItem('user_id');
    
    if (userId) {
        // Construir la URL con userId
        var urlConUserId = `/pestanas_Encuestado/Aplicador.php?userId=${userId}`;
        
        // Redirigir al usuario a la nueva URL
        window.location.href = urlConUserId;
    } else {
        // Si userId no está disponible, simplemente redirigir sin él
        window.location.href = '/pestanas_Encuestado/Aplicador.php';
    }
}
         </script>

          <div class="row justify-content-center p-3 ">
            <div class="col-12">
              <h3 class="text-center mb-4">Crear encuestas.</h3>
            </div>
            <div class="col-12">
              <label for="nombrecompletos" class="col-form-label px-4 text-center mb-2">Usted puede crear dos tipos
                de
                encuestas.</label>
              <div class="col-sm-12 text-center">
                <button class="btn btn-outline-success bg-border-mostaza bg-text-mostaza" id="tip_encuesta1"
                  onclick="window.location.href='../pestanas_Encuestador/crear_Evariables.html'">Encuesta
                  tipo variables </button>
                <button class="btn btn-outline-success bg-border-mostaza bg-text-mostaza" id="tip_encuesta2"
                  onclick="window.location.href='../pestanas_Encuestador/crear.html'">Encuesta
                  tipo reactivos</button>
              </div>
            </div>
          </div>

          <div class="row justify-content-center p-4">
            <div class="col-sm-12 text-center mb-3">
              <form class="d-flex" onsubmit="return false;">
                <!-- Código del modal -->
                <div class="modal fade" id="alertaModal" tabindex="-1" aria-labelledby="mymodel" aria-hidden="true"
                  style="display: none;" aria-modal="true" role="dialog">
                  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="mymodel">No se encontraron coincidencias</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body" id="alertaModalBody"></div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-outline-success bg-border-mostaza bg-text-mostaza"
                          data-bs-dismiss="modal">Aceptar</button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Fin del código del modal -->

                <div class="row justify-content-center mb-3">
                  <div class="col-12">
                    <h3 class="text-center mb-4">Lista de encuestas.</h3>
                  </div>
                  <div class="col-sm-4 text-center mb-2">
                    <label class="col-form-label px-4 text-center ">Buscar una encuesta</label>
                  </div>
                  <div class="col-sm-6 mb-2">
                    <input id="filtrar" class="form-control me-2" type="search" placeholder="Buscar nombre"
                      aria-label="Search">
                  </div>
                  <div class="col-sm-2 mb-2">
                    <button class="btn btn-outline-success bg-border-mostaza bg-text-mostaza" type="submit"
                      id="boton_filtrar" onclick="realizarBusqueda()">Filtrar</button>
                  </div>
                  
                
                </div>

              </form>
            </div>
          </div>
          <div class="row justify-content-center">
            <div id="resultado2"></div>
            <div id="tabla_encuestas"></div>
            <div id="crear_encuesta"></div>
            <div id="crear_encuestaVar"></div>
            <div id="resultado"></div>
           

          </div>
        </div>

      </div>
    </div>
  </section>
  <script>
    function verificar() {
  if (!navigator.onLine) {
    // La aplicación no tiene conexión a internet, obtén el correo del LocalStorage
    var correo = localStorage.getItem('user_correo');

    if (correo) {
      // Si se encontró el correo en el LocalStorage, usa el correo como clave primaria para obtener el token de IndexedDB
      var request = indexedDB.open('miBaseDeDatos', 2);

      request.onsuccess = function(event) {
        var db = event.target.result;
        var transaction = db.transaction('miAlmacen', 'readonly');
        var objectStore = transaction.objectStore('miAlmacen');

        var getRequest = objectStore.get(correo); // Usa el correo como clave primaria
        console.log(getRequest);
        getRequest.onsuccess = function(event) {
          var tokenData = event.target.result;
          console.log(tokenData);
          if (tokenData) {
            // Si se encontró el token en IndexedDB, colócalo en el campo de contraseña
            var correo = document.getElementById('aqui');
            correo.value = tokenData.correo;
          }
        };
      };
    } else {
      console.log('Correo no encontrado en el LocalStorage');
    }
  }
}
  </script>
  <script>
  
    // Guardar el estado de la barra lateral en el localStorage
    function saveSidebarState(state) {
      localStorage.setItem('sidebarState', state);
    }

    // Cargar el estado de la barra lateral del localStorage
    function loadSidebarState() {
      return localStorage.getItem('sidebarState') || 'expanded'; // Valor predeterminado: expandido
    }

    let arrow = document.querySelectorAll('.arrow');
    for (var i = 0; i < arrow.length; i++) {
      arrow[i].addEventListener('click', (e) => {
        let arrowParent = e.target.parentElement.parentElement; // seleccionar el elemento principal padre de la flecha
        arrowParent.classList.toggle('showMenu');
      });
    }

    let sidebar = document.querySelector('.sidebar');
    let sidebarBtn = document.querySelector('.bx-menu');
    console.log(sidebarBtn);

// Aplicar el estado almacenado al cargar la página
window.addEventListener('DOMContentLoaded', () => {
  const initialState = loadSidebarState();
  if (window.innerWidth <= 400) {
    // Si el ancho de la ventana es menor o igual a 400px (dispositivo móvil),
    // siempre oculta la barra lateral en la carga inicial.
    sidebar.classList.add('close');
    saveSidebarState('collapsed'); // Guarda el estado colapsado en el almacenamiento local
  } else {
    sidebar.classList.toggle('close', initialState === 'collapsed');
  }
});

    sidebarBtn.addEventListener('click', () => {
      sidebar.classList.toggle('close');
      const newState = sidebar.classList.contains('close') ? 'collapsed' : 'expanded';
      saveSidebarState(newState);
    });

  </script>

  <!-- desactivar los botones si no hay conexion a internet  -->
  <script>
    var button1 = document.getElementById('tip_encuesta1');
    var button2 = document.getElementById('tip_encuesta2');

    function checkInternetConnection() {
      var online = navigator.onLine;

      // Habilitar o deshabilitar los botones en función de la conexión
      button1.disabled = !online;
      button2.disabled = !online;
    }

    // Verificar la conexión inicialmente
    checkInternetConnection();

    // Agregar un listener para verificar cambios en la conexión
    window.addEventListener('online', checkInternetConnection);
    window.addEventListener('offline', checkInternetConnection);
  </script>

  <script>
    function showAlert(type) {
      var online = navigator.onLine;
      if (!online) {
        Swal.fire({
          icon: 'error',
          title: '¡Sin conexión a Internet!',
          text: `Necesitas conexión a Internet para crear ${type}.`,
        });
      } else {
        // Redirigir a la página correspondiente
        if (type === 'variables') {
          window.location.href = 'crear_Evariables.html';
        } else if (type === 'reactivos') {
          window.location.href = 'crear.html';
        }
      }
    }
  </script>
    

   <script src="/BD/src/jsSC.js"></script>
  <script src="/BD/src/sync.js"></script>
  <script src="/BD/registroUsuarios/registro.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/BD/prueva/encuesta.js"></script>
 <script> src="/BD/infoUser.php" </script>
  <script src="../CSS/SweetAlert.js"></script>
    <script src="/BD/src/sincronizar.php"></script>
</body>

</html>