<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categoria</title>
    <link rel="stylesheet" href="/CSS/styleDashboard.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../CSS/style.css">

    <link rel="stylesheet" href="../node_modules/@sweetalert2/themes/bootstrap-4/bootstrap-4.min.css">
    <script src="../node_modules/sweetalert2/dist/sweetalert2.all.js"></script>

    <!-- Boxiocns CDN Link -->
    <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

</head>

<body>
    <!-- Dashboard -->
    <div class="sidebar close">
        <div class="logo-details">
            <i class="bx seleccionador"></i>
            <span class="logo_name">Janal Kaaj</span>
        </div>


        <ul class="nav-links">
            <li>
                <a href="/pestanas_Encuestador/dashboard.html">
                    <i class="bx bx-grid-alt"></i>
                    <span class="link_name">Dashboard</span>
                </a>

                <ul class="sub-menu blank">
                    <li><a href="" id="mostrarSeccion1">Dashboard</a></li>
                </ul>
            </li>


            <li>
                <a href="/login.html">
                    <i class='bx bx-home-alt'></i>
                    <span class="link_name">Login</span>
                </a>

                <ul class="sub-menu blank">
                    <li><a class="link_name" href="/login.html">Login</a></li>
                </ul>
            </li>



            <li>
                <div class="iocn-link">
                    <a href="#" onclick="showAlert('variables')">
                        <!-- Llamamos a showAlert con el argumento 'variables' -->
                        <i class='bx bx-file-blank'></i>
                        <span class="link_name">Crear variables</span>
                    </a>
                    <ul class="sub-menu blank">
                        <a class="link_name" href="#" onclick="showAlert('variables')">Crear variables</a>
                    </ul>
                </div>
            </li>

            <li>
                <div class="iocn-link">
                    <a href="#" onclick="showAlert('reactivos')">
                        <!-- Llamamos a showAlert con el argumento 'reactivos' -->
                        <i class='bx bx-file-blank'></i>
                        <span class="link_name">Crear reactivos</span>
                    </a>
                </div>
                <ul class="sub-menu blank">
                    <a class="link_name" href="#" onclick="showAlert('reactivos')">Crear reactivos</a>
                </ul>
            </li>

            <li>
                <a id="pruebaApli" href="#" onclick="redireccionarConUserId()">
                    <i class='bx bx-book-add'></i>
                    <span class="link_name">Alta Aplicadores</span>
                </a>

                <ul class="sub-menu blank">
                    <li><a class="link_name" href="/pestanas_Encuestado//Aplicador.php">Alta Aplicadores</a></li>
                </ul>
            </li>

            <li>
                <a href="/pestanas_Encuestado/asignarE.php">
                    <i class='bx bxs-user-check'></i>
                    <span class="link_name">Asignar</span>
                </a>

                <ul class="sub-menu blank">
                    <li><a class="link_name" href="/pestanas_Encuestado/asignarE.php">Asignar</a></li>
                </ul>
            </li>

            <li>
                <a href="../BD/prueva/consultaDatos.php">
                    <i class='bx bx-clipboard bx-tada'></i>
                    <span class="link_name">Encuestas aplicadas</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="../BD/prueva/consultaDatos.php">Encuestas aplicadas</a></li>
                </ul>
            </li>

            <li>
                <a href="#" onclick="redireccionarConUserId2()">
                    <i class="bx bx-pie-chart-alt-2"></i>
                    <span class="link_name">Análisis</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="../BD/prueva/graficasELCSA.php">Análisis</a></li>
                </ul>
            </li>


            <li>
                <a href="#" onclick="redireccionarConUserId3()">
                    <i class="bx bx-line-chart"></i>
                    <span class="link_name">Graficas</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="../BD/prueva/graficasELCSAClasi.php">Graficas</a></li>
                </ul>
            </li>

            <!-- <li>
        <a href="#">
          <i class="bx bx-cog"></i>
          <span class="link_name">Configuración</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Configuración</a></li>
        </ul>
      </li> -->


            <li>
                <a href="perfil_Encuestador.html">
                    <i class='bx bx-user'></i>
                    <span class="link_name">Perfil</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="perfil_Encuestador.html">Perfil</a></li>
                </ul>
            </li>

            <!-- Cerrar cesion -->
            <li id="cerrarSesionBtnContainer">
                <a href="#" id="cerrarSesionBtn" onclick="confirmarCerrarSesion()">
                    <i class="bx bx-log-out"></i>
                    <span class="link_name">Cerrar Sesión</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="#" onclick="confirmarCerrarSesion()">Cerrar Sesión</a></li>

                </ul>
            </li>
        </ul>
    </div>

    <section class="home-section">
        <div class="home-content">
            <i class="bx bx-menu"></i>
            <span class="text">Categoria</span>
        </div>
        <!-- Fin Dashboard -->
        <div class="container col-12 col-sm-10 col-md-8 col-lg-6 p-3 shadow-lg  bg-white rounded">

            <h1 class="bg-text-black text-center p-3 text-uppercase text-black">Reactivos</h1>

            <div class="row">
                <div class="col-sm-5 text-center mb-3">
                    <h6>Categoría: </h6>
                </div>
                <div class="col-sm-5 text-center mb-3">

                    <select onchange=" mostrarElementosPorCategoria()" id="Categorias_R" class="form-select"
                        aria-label="Default select example" required>
                        <option value="">Seleccione una categoría...</option>
                        <option value="todo">Todo Los Reactivos</option>
                    </select>
                    <!-- <select onchange=" mostrarElementosPorCategoria()" id="Categorias_R" class="form-select"
                        aria-label="Default select example" required>
                        <option value="">Seleccione una categoría...</option>
                        <option value="Miel">Miel</option>
                        <option value="Agricultura">Agricultura</option>
                        <option value="Ganaderia">Ganaderia </option>
                        <option value="Otro">Otro </option>
                        <option value="todo">Todo Los Reactivos</option>
                    </select> -->

                </div>


                <div class="bg-text-black p-3 text-uppercase text-black">
                    <h5>Seleccione las preguntas</h5>
                </div>


                <div class="bg-text-black text-black">
                    <div class="row">
                        <div id="reactivosTable"></div>
                        <div class="form-check">

                            <!-- <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" > -->
                            <label class="form-check-label" for="flexCheckDefault">
                                <div id="salida"></div>
                                <div id="salida3"></div>
                                <div id="tablaElementos"></div>
                            </label>

                        </div>
                    </div>
                </div>

                <!-- <table id="tablaElementos"> -->
                <!-- botones  -->
                <div class="row mb-4">
                    <div class="col-sm-12 col-form-label text-center">
                        <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center">

                            <button
                                class="btn btn-outline-success bg-border-mostaza bg-text-mostaza mb-2 col-sm-4 col-12 me-2"
                                id="boton_guardar" type="submit"
                                onclick="predeSelecMos(), GuardarReactivosPre()">Guardar</button>

                            <button
                                class="btn btn-outline-success bg-border-mostaza bg-text-mostaza mb-2 col-sm-4 col-12"
                                id="boton_cancelar" onclick="cancelarReactivo()">Cancelar</button>

                        </div>
                    </div>
                </div>


            </div>


            <script>
                //para enviar el id a agregar aplicador 
                function redireccionarConUserId() {
                    var userId = localStorage.getItem('user_id');

                    if (userId) {
                        // Construir la URL con userId
                        var urlConUserId = `/pestanas_Encuestado/Aplicador.php?userId=${userId}`;

                        // Redirigir al usuario a la nueva URL
                        window.location.href = urlConUserId;
                    } else {
                        // Si userId no está disponible, simplemente redirigir sin él
                        window.location.href = '/pestanas_Encuestado/Aplicador.php';
                    }
                }
                function redireccionarConUserId2() {
                    var userId = localStorage.getItem('user_id');

                    if (userId) {
                        // Construir la URL con userId
                        var urlConUserId = `../BD/prueva/graficasELCSA.php?userId=${userId}`;

                        // Redirigir al usuario a la nueva URL
                        window.location.href = urlConUserId;
                    } else {
                        // Si userId no está disponible, simplemente redirigir sin él
                        window.location.href = '../BD/prueva/graficasELCSA.php';
                    }
                }
                function redireccionarConUserId3() {
                    var userId = localStorage.getItem('user_id');

                    if (userId) {
                        // Construir la URL con userId
                        var urlConUserId = `../BD/prueva/graficasELCSAClasi.php?userId=${userId}`;

                        // Redirigir al usuario a la nueva URL
                        window.location.href = urlConUserId;
                    } else {
                        // Si userId no está disponible, simplemente redirigir sin él
                        window.location.href = '../BD/prueva/graficasELCSAClasi.php';
                    }
                }
            </script>


    </section>
    <!-- <script>
        document.addEventListener('DOMContentLoaded', function () {
            var userId = localStorage.getItem('user_id');
            var userCorreo = localStorage.getItem('user_correo');
            
            if (userId) {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/BD/infoUser.php?id=' + userId, true);
                xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    try {
                        var userInfo = JSON.parse(xhr.responseText);
                        if (userInfo && userInfo.error) {
                            console.error('Error obteniendo información del usuario:', userInfo.error);
                        } else {
                          document.getElementById('aqui').value = userCorreo;
                        }
                    } catch (error) {
                        console.error('Error al analizar la respuesta JSON:', error);
                    }
                } else {
                    console.error('Error en la solicitud AJAX para obtener información del usuario.');
                }
            }
        };
                xhr.send();
            }
            recuperarR()
        });
      
                 </script> -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            $.ajax({
                url: '/BD/prueva/obtener_categoria.php',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // Llenar el select con las categorías obtenidas
                    var select = document.getElementById('Categorias_R');
                    data.forEach(function (categoria) {
                        var option = document.createElement('option');
                        option.value = categoria.id_categorias;
                        option.textContent = categoria.nombre_categoria;
                        select.appendChild(option);
                    });
                },
                error: function (xhr, status, error) {
                    console.error('Error al obtener las categorías: ' + error);
                }
            });
        });


    </script>
    <!-- <script>
    // Al cargar la página, obtener las categorías mediante una solicitud AJAX
    $(document).ready(function() {
        $.ajax({
            url: '/BD/prueva/obtener_categoria.php',
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                // Llenar el select con las categorías obtenidas
                var select = document.getElementById('Categorias_R');
                data.forEach(function(categoria) {
                    var option = document.createElement('option');
                    option.value = categoria.id_categoria;
                    option.textContent = categoria.nombre_categoria;
                    select.appendChild(option);
                });
            },
            error: function(xhr, status, error) {
                console.error('Error al obtener las categorías: ' + error);
            }
        });
    });
</script> -->

    <script>
        // Guardar el estado de la barra lateral en el localStorage
        function saveSidebarState(state) {
            localStorage.setItem('sidebarState', state);
        }

        // Cargar el estado de la barra lateral del localStorage
        function loadSidebarState() {
            return localStorage.getItem('sidebarState') || 'expanded'; // Valor predeterminado: expandido
        }

        let arrow = document.querySelectorAll('.arrow');
        for (var i = 0; i < arrow.length; i++) {
            arrow[i].addEventListener('click', (e) => {
                let arrowParent = e.target.parentElement.parentElement; // seleccionar el elemento principal padre de la flecha
                arrowParent.classList.toggle('showMenu');
            });
        }

        let sidebar = document.querySelector('.sidebar');
        let sidebarBtn = document.querySelector('.bx-menu');
        console.log(sidebarBtn);

        // Aplicar el estado almacenado al cargar la página
        window.addEventListener('DOMContentLoaded', () => {
            const initialState = loadSidebarState();
            sidebar.classList.toggle('close', initialState === 'collapsed');
        });

        sidebarBtn.addEventListener('click', () => {
            sidebar.classList.toggle('close');
            const newState = sidebar.classList.contains('close') ? 'collapsed' : 'expanded';
            saveSidebarState(newState);
        });
    </script>

    <script>
        function showAlert(type) {
            var online = navigator.onLine;
            if (!online) {
                Swal.fire({
                    icon: 'error',
                    title: '¡Sin conexión a Internet!',
                    text: `Necesitas conexión a Internet para crear ${type}.`,
                });
            } else {
                // Redirigir a la página correspondiente
                if (type === 'variables') {
                    window.location.href = 'crear_Evariables.html';
                } else if (type === 'reactivos') {
                    window.location.href = 'crear.html';
                }
            }
        }
    </script>
      <script>
        const channel = new BroadcastChannel('miCanal');
channel.postMessage('ejecutarCiclo');
      </script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script src="/BD/src/sync.js"></script>
     <script src="/BD/prueva/encuesta.js"></script>
<script>
        function confirmarCerrarSesion() {
    Swal.fire({
        title: '¿Estás seguro?',
        text: '¿Deseas cerrar la sesión?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Sí, cerrar sesión',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            // Si el usuario confirma, eliminar los datos del usuario del almacenamiento local
            localStorage.removeItem('user_correo');
            localStorage.removeItem('user_id');
            localStorage.removeItem('tipoUsuario');
            console.log("Sesión cerrada correctamente.");
            
            // Mostrar una alerta con el mensaje de cierre en dos segundos
            Swal.fire({
                title: 'Cerrando sesión...',
                icon: 'success',
                timer: 2000,
                timerProgressBar: true,
                showConfirmButton: false
            });

            // Redireccionar a la página de inicio de sesión después de dos segundos
            setTimeout(function() {
                window.location.href = '/login.html';
            }, 2000);
        } else {
            // Si el usuario cancela, no hacer nada
        }
    });
}

    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/BD/src/sync.js"></script>
    <script src="/BD/prueva/encuesta.js"></script>
    <script src="/BD/registroUsuarios/registro.js"></script>
    <!-- <script src="../BD/app.js"></script> -->
    <script src="../CSS/SweetAlert.js"></script>
</body>

</html>